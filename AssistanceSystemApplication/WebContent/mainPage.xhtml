<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:p="http://primefaces.org/ui">
<h:head>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false"></script>
    <link rel="stylesheet" type="text/css" href="resources/styles/newsFeedStyle.css"></link>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet'/>
    <script src="resources/scripts/mapBoxInit.js"></script>
</h:head>
<h:body xmlns:f="http://java.sun.com/jsf/core">
    <f:metadata>
        <f:event type="preRenderView" listener="#{assistanceCallBean.importAssistanceCalls}"/>
        <f:event type="preRenderView" listener="#{categoryOfCallBean.importCategories}"/>
    </f:metadata>
    <div class="header"><h2><b>Assistance system</b></h2></div>
    <div class="row">
        <div class="leftcolumn"><a style="color:#f5d7b5;user-input: none">bfdbdfb</a></div>
        <div class="midcolumn">
            <div id="createCall" class="card" style="text-align: center">
                <h:form class="postType2">
                    <a style="margin: auto">Choose category of assistance call: </a>
                    <h:selectOneMenu placeholder="Choose a category of assistance call" style="min-width: 100px" id="selectCategory"
                                     value="#{assistanceCallBean.assistanceCall.categoryId}">
                        <f:selectItems value="#{categoryOfCallBean.categories}" var="entry"
                                       itemValue="#{entry.id}" itemLabel="#{entry.name}"/>
                    </h:selectOneMenu>
                    <br/><br/>
                    <div>
                        <p:inputText placeholder="Title" required="true" value="#{assistanceCallBean.assistanceCall.name}"></p:inputText>
                    </div>
                    <br/>
                    <div>
                        <p:inputTextarea placeholder="Description" required="true" value="#{assistanceCallBean.assistanceCall.description}" rows="5"
                                         cols="50"></p:inputTextarea>
                    </div>
                    <br/>
                    <div>
                        <p:inputText placeholder="URL of picture:" required="true" value="#{assistanceCallBean.assistanceCall.urlPicture}"></p:inputText><br/>
                    </div>
                    <br/>
                    <div>
                        <div id="map" style="width: 75%; height: 300px; margin: auto;"></div>
                        <h:outputScript>initMap()</h:outputScript>
                        <div style="display: none">
                            <input id="lat" type="text" name="lat"></input>
                            <input id="lng" type="text" name="lng"></input>
                        </div>
                    </div>
                    <br/>
                    <div>
                        <p:inputText placeholder="Author" required="true" value="#{assistanceCallBean.assistanceCall.author}"></p:inputText>
                    </div>
                    <br/>
                    <div>
                        <p:inputText placeholder="Phone number" required="false" value="#{assistanceCallBean.assistanceCall.phone}"></p:inputText>
                    </div>
                    <br/>
                    <p:commandButton style="margin: auto" type="submit" update="@form" value="Create call"
                                     action="#{assistanceCallBean.createCall}"></p:commandButton>
                </h:form>
            </div>
            <ui:repeat var="call" value="#{assistanceCallBean.assistanceCallList}">
            <h:form id="form1" class="card" style="text-align: center">
                <h2><h:outputText value="#{call.assistanceCall.name}"></h:outputText></h2>
                <hr></hr>
                <br/><br/>
                <h:outputText value="Description: #{call.assistanceCall.description}"></h:outputText>
                <br/><br/>
                <div id="map#{call.assistanceCall.id}" style="width: 80%; height: 300px; margin-left:10%" ></div>
                <h:outputScript rendered="#{call.assistanceCall.location.length()!=0 || call.assistanceCall.location!=null}">initMap('#{call.assistanceCall.location}', '#{call.assistanceCall.id}', false)</h:outputScript>
                <br/><br/>
                <h:graphicImage style="width: 50%; margin: auto"
                                value="#{call.assistanceCall.urlPicture}" rendered="#{call.assistanceCall.urlPicture.length()!=0 || call.assistanceCall.urlPicture!=null}"></h:graphicImage>
                <hr></hr>
                <h:outputText value="Datetime: #{call.assistanceCall.datetimeConverted}"></h:outputText>
                <br/><br/>
                <h:outputText value="Author: #{call.assistanceCall.author}"></h:outputText>
                <br/><br/>
                <h:outputText value="Phone number: #{call.assistanceCall.phone}" rendered="#{call.assistanceCall.phone.length()!=0 || call.assistanceCall.phone!=null}"></h:outputText>
                <br/><br/>
                <h:commandButton id='report#{call.assistanceCall.id}' value="Report this post"
                                 action="#{call.reportCall}" rendered="#{!call.checkIsReported}"></h:commandButton>
                <h:outputLabel rendered="#{call.checkIsReported}">You already reported this post.</h:outputLabel>
            </h:form>
    </ui:repeat>
</div>
<div class="rightcolumn">
    <h:graphicImage style="width: 128px; height: 128px; float: right; padding: 20px"
                    onclick="window.location = 'calls.xml'"
                    value="https://cdn3.iconfinder.com/data/icons/complete-set-icons/512/rss512x512.png"></h:graphicImage>
</div>
</div>
<div class="footer"></div>
        </h:body>
        </html>